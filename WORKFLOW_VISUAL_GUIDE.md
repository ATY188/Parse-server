# 📊 Google Alert 自動化系統 - 視覺化流程

## 🎯 系統架構總覽

```
┌─────────────────────────────────────────────────────────────────────┐
│                         完整自動化流程                                │
└─────────────────────────────────────────────────────────────────────┘

    ┌──────────────┐
    │ Google Alert │  每當有新聞時寄送郵件
    └──────┬───────┘
           │ 📧 郵件
           ↓
    ┌──────────────┐
    │  你的 Gmail   │  收到 Google Alert 郵件
    └──────┬───────┘
           │
           │ 自動觸發
           ↓
┌──────────────────────────────────────────────────────────────────────┐
│                         N8N Workflow                                  │
│                                                                       │
│  1️⃣  [Gmail Trigger]                                                 │
│      └─ 監聽新郵件（來自 googlealerts-noreply@google.com）           │
│           │                                                           │
│           ↓                                                           │
│  2️⃣  [Extract URLs]                                                  │
│      └─ 提取郵件中的所有新聞網址                                      │
│           │ 範例：https://technews.tw/article-123                    │
│           ↓                                                           │
│  3️⃣  [Read Google Sheet]                                             │
│      └─ 讀取現有的網址列表                                            │
│           │                                                           │
│           ↓                                                           │
│  4️⃣  [Filter Duplicates]                                             │
│      └─ 過濾掉已存在的網址（去重）                                    │
│           │                                                           │
│           ↓                                                           │
│  5️⃣  [Append to Sheet]                                               │
│      └─ 將新網址寫入 Google Sheet（status = pending）                │
│           │                                                           │
│           ↓                                                           │
│  6️⃣  [Wait 3 seconds]                                                │
│      └─ 等待 Sheet 寫入完成                                           │
│           │                                                           │
│           ↓                                                           │
│  7️⃣  [Parse Article]  ←─────────────────┐                           │
│      └─ 呼叫 Parser API                   │                           │
│           │                                │                           │
│           ↓                                │                           │
│  8️⃣  [Check Success?]                     │                           │
│      └─ 檢查解析是否成功                   │                           │
│           │                                │                           │
│      ┌────┴────┐                          │                           │
│      ↓         ↓                          │                           │
│   ✅ 成功    ❌ 失敗                       │                           │
│      │         │                          │                           │
│      │         └─ [Update Failed] ────────┘                           │
│      │            （標記為 failed）                                    │
│      │                                                                 │
│      ↓                                                                 │
│  9️⃣  [Generate AI Summary]                                           │
│      └─ 使用 OpenAI 生成摘要                                          │
│           │                                                           │
│           ↓                                                           │
│  🔟 [Prepare Data]                                                   │
│      └─ 整理所有資料                                                  │
│           │                                                           │
│           ↓                                                           │
│  1️⃣1️⃣ [Find Row Number]                                              │
│      └─ 找到要更新的行號                                              │
│           │                                                           │
│           ↓                                                           │
│  1️⃣2️⃣ [Update Sheet]                                                 │
│      └─ 更新 Google Sheet（status = completed）                      │
│           │                                                           │
│           ↓                                                           │
│  1️⃣3️⃣ [Mark Email as Read]                                           │
│      └─ 標記郵件為已讀                                                │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
           │
           ↓
    ┌──────────────┐
    │ Google Sheet │  ✅ 完成！可以查看結果
    └──────────────┘
```

---

## 📧 郵件處理流程

```
┌────────────────────────────────────────────────────────────────┐
│ 收到的 Google Alert 郵件範例                                    │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 主旨：Google 快訊 - 聯發科                                      │
│ 寄件者：googlealerts-noreply@google.com                        │
│                                                                 │
│ ───────────────────────────────────────                        │
│                                                                 │
│ 📰 聯發科推出新晶片 挑戰高通霸主地位                            │
│    科技新報 - 1 小時前                                          │
│    https://technews.tw/2025/11/02/mediatek-chip/              │
│                                                                 │
│ 📰 聯發科Q3財報亮眼 營收創新高                                  │
│    經濟日報 - 3 小時前                                          │
│    https://money.udn.com/money/story/5612/12345               │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
                         │
                         │ N8N 自動提取
                         ↓
┌────────────────────────────────────────────────────────────────┐
│ 提取的資料                                                       │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│ URL 1: https://technews.tw/2025/11/02/mediatek-chip/          │
│ Keyword: 聯發科                                                 │
│ Source: Google Alert                                            │
│                                                                 │
│ URL 2: https://money.udn.com/money/story/5612/12345           │
│ Keyword: 聯發科                                                 │
│ Source: Google Alert                                            │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

---

## 🔄 去重邏輯

```
┌────────────────────┐      ┌────────────────────┐
│  新提取的網址       │      │  Google Sheet       │
│                    │      │  現有網址           │
│  URL 1: technews/A │      │  • technews/B       │
│  URL 2: udn/C  ←───┼──────┼─ • udn/C (重複)     │
│  URL 3: bnext/D    │      │  • bnext/E          │
└────────────────────┘      └────────────────────┘
         │
         │ 去重後
         ↓
┌────────────────────┐
│  實際處理的網址     │
│                    │
│  URL 1: technews/A │  ✅ 新的，處理
│  URL 2: udn/C      │  ❌ 重複，跳過
│  URL 3: bnext/D    │  ✅ 新的，處理
└────────────────────┘
```

---

## 📊 Google Sheet 資料流

```
初始狀態（剛寫入）
┌──────────────────────────────────────────────────────────────┐
│ url                | title | ... | status  | processed_time  │
├──────────────────────────────────────────────────────────────┤
│ technews/article-A |       |     | pending |                 │
└──────────────────────────────────────────────────────────────┘
                              │
                              │ Parser API 解析中...
                              ↓
處理中（API 呼叫中）
┌──────────────────────────────────────────────────────────────┐
│ url                | title | ... | status     | processed... │
├──────────────────────────────────────────────────────────────┤
│ technews/article-A |       |     | processing |              │
└──────────────────────────────────────────────────────────────┘
                              │
                              │ AI 生成摘要...
                              ↓
完成（所有資料已填入）
┌──────────────────────────────────────────────────────────────┐
│ url         | title      | summary    | status    | time     │
├──────────────────────────────────────────────────────────────┤
│ technews/A  | 聯發科...  | 本文討論... | completed | 14:30:00 │
└──────────────────────────────────────────────────────────────┘
                              │
                              ↓
                          ✅ 可以查看！
```

---

## 🎨 狀態顏色標示

```
┌────────────────────────────────────────────────────────┐
│ Google Sheet 的狀態欄位會自動標上顏色                   │
└────────────────────────────────────────────────────────┘

🟡 pending      → 黃色背景（待處理）
                  剛加入，等待系統處理

🔵 processing   → 藍色背景（處理中）
                  正在呼叫 API 和 AI

🟢 completed    → 綠色背景（已完成）
                  所有資料已填入，可以查看

🔴 failed       → 紅色背景（失敗）
                  處理失敗，需要檢查


範例顯示：

┌──────────────┬──────────┐
│ url          │ status   │
├──────────────┼──────────┤
│ technews/A   │ 🟢 completed │ ← 成功！
│ udn/B        │ 🟡 pending   │ ← 等待處理
│ bnext/C      │ 🔴 failed    │ ← 需要檢查
└──────────────┴──────────┘
```

---

## ⚡ 處理速度

```
單一文章處理時間線：

00:00  📧 收到 Google Alert 郵件
00:01  🔍 N8N 偵測到新郵件（Gmail Trigger）
00:02  📝 提取網址
00:03  ✅ 檢查重複
00:04  ➕ 寫入 Google Sheet
00:07  🌐 呼叫 Parser API（3-10 秒）
00:15  🤖 AI 生成摘要（5-10 秒）
00:17  💾 更新 Google Sheet
00:18  ✅ 完成！

總時間：約 15-20 秒 / 文章
```

---

## 🔄 批次處理（多篇文章）

```
如果 Google Alert 一次寄送 5 篇文章：

                    ┌─ 文章 1 (20秒) ─┐
                    ├─ 文章 2 (20秒) ─┤
郵件 → 提取 5 個網址 ┼─ 文章 3 (20秒) ─┼→ 全部完成
                    ├─ 文章 4 (20秒) ─┤
                    └─ 文章 5 (20秒) ─┘

順序處理（避免 API 過載）
總時間：約 1.5-2 分鐘


如果想要加速，可以改為平行處理：

                    ┌─ 文章 1 ─┐
                    ├─ 文章 2 ─┤
郵件 → 提取 5 個網址 ┼─ 文章 3 ─┼→ 全部完成
    （同時處理）     ├─ 文章 4 ─┤
                    └─ 文章 5 ─┘

平行處理（需要更多資源）
總時間：約 20-30 秒
```

---

## 💡 實際使用場景

### 場景 1：每日新聞收集

```
早上 08:00
├─ Google Alert: 寄送「聯發科」相關新聞 (3 則)
├─ Google Alert: 寄送「台積電」相關新聞 (5 則)
└─ Google Alert: 寄送「輝達」相關新聞 (2 則)
    │
    │ N8N 自動處理（約 3 分鐘）
    ↓
    Google Sheet 新增 10 筆資料
    ├─ 8 筆成功（status = completed）
    └─ 2 筆失敗（status = failed，可能是付費牆）

早上 08:05
└─ 你打開 Google Sheet，所有資料都已經準備好！
```

### 場景 2：即時快訊

```
下午 14:30
└─ Google Alert: 【突發】台積電宣布重大消息
    │
    │ 即時觸發（約 20 秒）
    ↓
    Google Sheet 立即更新
    └─ 你在手機上收到通知（如果有設定）
```

### 場景 3：週末批次處理

```
週末累積了 50 封 Google Alert 郵件
│
│ 週一早上啟用 Workflow
↓
N8N 批次處理（約 15-20 分鐘）
├─ 處理 50 封郵件
├─ 提取 150 個網址
├─ 去重後剩 80 個新網址
└─ 全部解析和生成摘要

結果
└─ Google Sheet 新增 80 筆完整資料
```

---

## 📈 系統容量

```
┌──────────────────────────────────────────────────────┐
│ 系統處理能力                                          │
├──────────────────────────────────────────────────────┤
│                                                       │
│ 每小時：約 180 篇文章                                 │
│ 每天：約 4,000 篇文章                                 │
│ 每月：約 120,000 篇文章                               │
│                                                       │
│ Google Sheet 容量限制：                               │
│ • 最多 1000 萬個儲存格                                │
│ • 約可儲存 100,000 篇文章                             │
│                                                       │
│ 建議：                                                │
│ • 每月建立新的 Sheet                                  │
│ • 或定期歸檔舊資料                                    │
│                                                       │
└──────────────────────────────────────────────────────┘
```

---

## 🎯 關鍵節點詳解

### 1️⃣ Gmail Trigger
```
功能：監聽新郵件
觸發條件：
  ✓ 寄件者 = googlealerts-noreply@google.com
  ✓ 主旨包含 "Google 快訊"
  ✓ 狀態 = 未讀
執行頻率：每 1 分鐘檢查一次
```

### 2️⃣ Extract URLs (Code 節點)
```
功能：從郵件中提取網址
技術：正規表達式
處理：
  • 提取所有 https:// 開頭的網址
  • 排除 Google 追蹤連結
  • 清理網址格式
  • 去重
輸出：網址列表 + 關鍵字
```

### 3️⃣ Read Google Sheet
```
功能：讀取現有資料
讀取範圍：A 欄（url 欄位）
用途：檢查重複
快取：每次執行都重新讀取
```

### 4️⃣ Filter Duplicates (Code 節點)
```
功能：過濾重複網址
邏輯：
  IF url 存在於 Google Sheet
    THEN 跳過
  ELSE 保留
輸出：只有新的網址
```

### 5️⃣ Append to Google Sheet
```
功能：寫入新資料
寫入欄位：
  • url (必填)
  • keyword (自動填入)
  • source (固定為 "Google Alert")
  • status (固定為 "pending")
其他欄位：留空，等待後續填入
```

### 6️⃣ Wait
```
功能：等待 Google Sheet 寫入完成
時間：3 秒
原因：確保資料已同步
```

### 7️⃣ Parse Article (HTTP Request)
```
功能：呼叫 Parser API
端點：https://web-production-32568.up.railway.app/api/parse
方法：POST
Body：{"url": "..."}
Timeout：30 秒
錯誤處理：Continue On Fail = true
```

### 8️⃣ Check Parse Success (IF 節點)
```
功能：判斷 API 是否成功
條件：
  IF error 為空 AND status = "success"
    THEN 繼續生成摘要（成功分支）
  ELSE 更新為 failed（失敗分支）
```

### 9️⃣ Generate AI Summary (OpenAI)
```
功能：生成文章摘要
模型：GPT-3.5-turbo（較便宜）或 GPT-4
Prompt：150 字繁體中文摘要
Tokens：300
Temperature：0.5（較保守）
成本：約 $0.01 / 文章
```

### 🔟 Prepare Update Data (Set 節點)
```
功能：整理所有資料
來源：
  • Parse Article 節點的資料
  • Generate AI Summary 節點的資料
  • 原始的 keyword 和 source
輸出：完整的資料物件
```

### 1️⃣1️⃣ Find Row Number (Code 節點)
```
功能：找到要更新的行號
邏輯：
  FOR 每一行 IN Google Sheet
    IF url 匹配
      THEN 記錄行號
      BREAK
輸出：row_number（例如：5）
```

### 1️⃣2️⃣ Update Google Sheet Success
```
功能：更新整列資料
範圍：B{{ row_number }}:J{{ row_number }}
更新：所有欄位（title, author, content, ...）
狀態：completed
時間：當前時間
```

### 1️⃣3️⃣ Mark Email as Read
```
功能：標記郵件為已讀
原因：避免重複處理
操作：移除 UNREAD 標籤
```

---

## 🎓 學習資源

### 了解各個服務

```
┌─────────────────┬──────────────────────────────┐
│ Google Alerts   │ 關鍵字監控服務                │
│                 │ https://google.com/alerts    │
├─────────────────┼──────────────────────────────┤
│ N8N             │ 工作流程自動化平台            │
│                 │ https://n8n.io/              │
├─────────────────┼──────────────────────────────┤
│ Google Sheets   │ 線上試算表                    │
│                 │ https://sheets.google.com    │
├─────────────────┼──────────────────────────────┤
│ Parser API      │ 文章內容解析 API              │
│                 │ （你已部署的服務）            │
├─────────────────┼──────────────────────────────┤
│ OpenAI          │ AI 語言模型                   │
│                 │ https://openai.com/          │
└─────────────────┴──────────────────────────────┘
```

---

## 📞 快速故障排除

```
問題：郵件沒有觸發 Workflow
└─ 檢查清單：
    ├─ Workflow 是否 Active？
    ├─ Gmail Trigger Filter 是否正確？
    ├─ 郵件是否在垃圾郵件？
    └─ Gmail Credential 是否過期？

問題：網址提取失敗
└─ 檢查清單：
    ├─ 查看 "Extract URLs" 節點輸出
    ├─ 郵件內容是否正確？
    ├─ 正規表達式是否需要調整？
    └─ 是否有 console.log 輸出？

問題：Parser API 失敗
└─ 檢查清單：
    ├─ API 健康檢查是否正常？
    ├─ 網址是否可以訪問？
    ├─ 是否遇到付費牆？
    └─ 網站是否需要登入？

問題：AI 摘要失敗
└─ 檢查清單：
    ├─ OpenAI API Key 是否正確？
    ├─ 帳戶是否有餘額？
    ├─ 是否超過 rate limit？
    └─ Prompt 是否正確？

問題：Google Sheet 沒更新
└─ 檢查清單：
    ├─ Sheet 名稱是否正確？
    ├─ Credential 是否授權？
    ├─ Sheet ID 是否正確？
    └─ 欄位標題是否一致？
```

---

## 🎉 成功標誌

當你看到以下畫面，代表系統運作正常：

```
✅ N8N Executions
   └─ All nodes reen checkmarks

✅ Google Sheet
   ┌───────────────┬──────────┬─────────────┐
   │ url           │ status   │ summary     │
   ├───────────────┼──────────┼─────────────┤
   │ technews/...  │ 🟢 completed │ 本文討論... │
   │ udn/...       │ 🟢 completed │ 聯發科...   │
   │ bnext/...     │ 🟢 completed │ 台積電...   │
   └───────────────┴──────────┴─────────────┘

✅ Gmail
   └─ Google Alert 郵件標記為已讀

✅ Parser API
   └─ Health check returns {"status": "ok"}
```

---

**系統已就緒，享受自動化的便利！** 🚀











