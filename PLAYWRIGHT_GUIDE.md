# ğŸ­ Playwright å‹•æ…‹ç¶²ç«™è§£ææŒ‡å—

## ğŸ“Œ ä»€éº¼æ™‚å€™ä½¿ç”¨ Playwrightï¼Ÿ

### âœ… ä½¿ç”¨ `/api/parse-dynamic` (Playwright) çš„æƒ…æ³

1. **React / Vue / Angular å–®é æ‡‰ç”¨ (SPA)**
   - ç¶²ç«™ä½¿ç”¨å‰ç«¯æ¡†æ¶
   - å…§å®¹é€šé JavaScript å‹•æ…‹åŠ è¼‰

2. **AJAX å‹•æ…‹å…§å®¹**
   - å…§å®¹åœ¨é é¢è¼‰å…¥å¾Œæ‰å‡ºç¾
   - éœ€è¦æ»¾å‹•æ‰èƒ½è¼‰å…¥æ›´å¤šå…§å®¹

3. **éœ€è¦ç­‰å¾…ç‰¹å®šå…ƒç´ **
   - å…§å®¹åŠ è¼‰éœ€è¦æ™‚é–“
   - å¿…é ˆç­‰å¾…ç‰¹å®šå…ƒç´ å‡ºç¾

4. **ç¤ºä¾‹ç¶²ç«™ï¼š**
   - âœ… `applealmond.com` (å‹•æ…‹åŠ è¼‰)
   - âœ… React/Vue ç¶²ç«™
   - âœ… éœ€è¦ JavaScript æ¸²æŸ“çš„æ–°èç¶²ç«™

---

### âœ… ä½¿ç”¨ `/api/parse` (æ¨™æº–) çš„æƒ…æ³

1. **å‚³çµ±ä¼ºæœå™¨ç«¯æ¸²æŸ“ç¶²ç«™**
   - å…§å®¹ç›´æ¥åœ¨ HTML ä¸­
   - ä¸éœ€è¦ JavaScript åŸ·è¡Œ

2. **éœæ…‹ç¶²ç«™**
   - HTML å·²åŒ…å«æ‰€æœ‰å…§å®¹
   - é€Ÿåº¦è¦æ±‚é«˜çš„å ´æ™¯

3. **ç¤ºä¾‹ç¶²ç«™ï¼š**
   - âœ… Wikipedia
   - âœ… å‚³çµ±æ–°èç¶²ç«™
   - âœ… éƒ¨è½æ ¼

---

## ğŸš€ API ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: åŸºæœ¬ä½¿ç”¨ï¼ˆç„¡éœ€ç­‰å¾…ç‰¹å®šå…ƒç´ ï¼‰

```bash
curl -X POST https://web-production-32568.up.railway.app/api/parse-dynamic \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://applealmond.com/posts/296254"
  }'
```

**é©ç”¨å ´æ™¯ï¼š**
- ç¶²ç«™åœ¨ 2 ç§’å…§å®ŒæˆåŠ è¼‰
- ä¸éœ€è¦ç­‰å¾…ç‰¹å®šå…ƒç´ 

---

### æ–¹æ³• 2: ç­‰å¾…ç‰¹å®šå…ƒç´ ï¼ˆæ¨è–¦ï¼‰

```bash
curl -X POST https://web-production-32568.up.railway.app/api/parse-dynamic \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://applealmond.com/posts/296254",
    "wait_for": ".post-content"
  }'
```

**é©ç”¨å ´æ™¯ï¼š**
- å…§å®¹éœ€è¦è¼ƒé•·æ™‚é–“åŠ è¼‰
- å·²çŸ¥ç›®æ¨™å…ƒç´ çš„ CSS é¸æ“‡å™¨

---

### æ–¹æ³• 3: åœ¨ n8n ä¸­ä½¿ç”¨

**HTTP Request ç¯€é»é…ç½®ï¼š**

1. **Method**: POST
2. **URL**: `https://web-production-32568.up.railway.app/api/parse-dynamic`
3. **Body Type**: JSON
4. **Body**:
```json
{
  "url": "{{ $json.url }}",
  "wait_for": ".article-content"
}
```

---

## ğŸ¯ å¦‚ä½•æ‰¾åˆ° CSS é¸æ“‡å™¨ (wait_for)

### æ­¥é©Ÿ 1: æ‰“é–‹é–‹ç™¼è€…å·¥å…·

1. åœ¨ç€è¦½å™¨ä¸­æ‰“é–‹ç›®æ¨™ç¶²ç«™
2. æŒ‰ `F12` æˆ–å³éµ â†’ "æª¢æŸ¥"
3. é»æ“Šå·¦ä¸Šè§’çš„ "é¸æ“‡å…ƒç´ " å·¥å…·

### æ­¥é©Ÿ 2: æ‰¾åˆ°ç›®æ¨™å…ƒç´ 

1. é»æ“Šæ–‡ç« å…§å®¹å€åŸŸ
2. æŸ¥çœ‹å…ƒç´ çš„ class æˆ– id
3. å¸¸è¦‹é¸æ“‡å™¨ï¼š
   - `.article-content` (class)
   - `#main-content` (id)
   - `article` (æ¨™ç±¤)
   - `.post-content` (class)

### æ­¥é©Ÿ 3: æ¸¬è©¦é¸æ“‡å™¨

åœ¨é–‹ç™¼è€…å·¥å…·çš„ Console ä¸­è¼¸å…¥ï¼š
```javascript
document.querySelector('.article-content')
```

å¦‚æœè¿”å›å…ƒç´ ï¼ˆä¸æ˜¯ nullï¼‰ï¼Œé¸æ“‡å™¨å°±æ˜¯æ­£ç¢ºçš„ï¼

---

## âš¡ æ€§èƒ½æ¯”è¼ƒ

| åŠŸèƒ½ | `/api/parse` (æ¨™æº–) | `/api/parse-dynamic` (Playwright) |
|------|---------------------|-----------------------------------|
| **é€Ÿåº¦** | âš¡âš¡âš¡ å¿«é€Ÿ (1-3ç§’) | âš¡ è¼ƒæ…¢ (3-10ç§’) |
| **è³‡æºæ¶ˆè€—** | ğŸ’š ä½ | ğŸ’› ä¸­ç­‰ |
| **æ”¯æ´å‹•æ…‹å…§å®¹** | âŒ ä¸æ”¯æ´ | âœ…âœ… å®Œå…¨æ”¯æ´ |
| **JavaScript åŸ·è¡Œ** | âŒ ä¸åŸ·è¡Œ | âœ…âœ… å®Œå…¨åŸ·è¡Œ |
| **é©ç”¨ç¶²ç«™** | 70% ç¶²ç«™ | 100% ç¶²ç«™ |

---

## ğŸ“Š å®Œæ•´ç¤ºä¾‹

### æ¸¬è©¦ Apple Almondï¼ˆä¹‹å‰å¤±æ•—çš„ç¶²ç«™ï¼‰

```bash
# ä½¿ç”¨æ¨™æº–æ–¹æ³•ï¼ˆæœƒå¤±æ•—ï¼‰
curl -X POST https://web-production-32568.up.railway.app/api/parse \
  -H "Content-Type: application/json" \
  -d '{"url": "https://applealmond.com/posts/296254"}'

# è¿”å›ï¼šsuccess: true, ä½† content ç‚ºç©º

# ä½¿ç”¨ Playwright æ–¹æ³•ï¼ˆæˆåŠŸï¼‰
curl -X POST https://web-production-32568.up.railway.app/api/parse-dynamic \
  -H "Content-Type: application/json" \
  -d '{"url": "https://applealmond.com/posts/296254", "wait_for": "article"}'

# è¿”å›ï¼šsuccess: true, content æœ‰å®Œæ•´å…§å®¹ï¼
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å•é¡Œ 1: Playwright è¶…æ™‚

**éŒ¯èª¤è¨Šæ¯ï¼š**
```
Playwright è¶…æ™‚: Timeout 30000ms exceeded
```

**è§£æ±ºæ–¹æ¡ˆï¼š**
- æª¢æŸ¥ç¶²å€æ˜¯å¦æ­£ç¢º
- å˜—è©¦ä¸ä½¿ç”¨ `wait_for` åƒæ•¸
- æª¢æŸ¥ç¶²ç«™æ˜¯å¦éœ€è¦ç™»å…¥

---

### å•é¡Œ 2: æ‰¾ä¸åˆ°å…ƒç´ 

**éŒ¯èª¤è¨Šæ¯ï¼š**
```
waiting for selector ".article-content" failed: timeout
```

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥ CSS é¸æ“‡å™¨æ˜¯å¦æ­£ç¢º
2. å˜—è©¦ä½¿ç”¨æ›´é€šç”¨çš„é¸æ“‡å™¨ï¼Œå¦‚ `article` æˆ– `main`
3. ä¸ä½¿ç”¨ `wait_for` åƒæ•¸ï¼Œè®“ç³»çµ±è‡ªå‹•ç­‰å¾…

---

### å•é¡Œ 3: å…§å®¹ä»ç„¶ç‚ºç©º

**å¯èƒ½åŸå› ï¼š**
- ç¶²ç«™éœ€è¦ç™»å…¥
- ç¶²ç«™æœ‰åš´æ ¼çš„åçˆ¬èŸ²æªæ–½
- å…§å®¹åœ¨ iframe ä¸­ï¼ˆPlaywright éœ€è¦ç‰¹æ®Šè™•ç†ï¼‰

**è§£æ±ºæ–¹æ¡ˆï¼š**
- ç¢ºèªç¶²ç«™åœ¨ç€è¦½å™¨ä¸­èƒ½æ­£å¸¸è¨ªå•
- æª¢æŸ¥ç¶²ç«™æ˜¯å¦éœ€è¦ Cookie æˆ–ç™»å…¥
- è¯ç¹«é–‹ç™¼è€…å”åŠ©è™•ç†ç‰¹æ®Šæƒ…æ³

---

## ğŸ“ æœ€ä½³å¯¦è¸

### 1. å„ªå…ˆä½¿ç”¨æ¨™æº– API

```
é¦–å…ˆå˜—è©¦ /api/parse
â†“
å¦‚æœå…§å®¹ç‚ºç©ºæˆ–ä¸å®Œæ•´
â†“
ä½¿ç”¨ /api/parse-dynamic
```

**åŸå› ï¼š**
- æ¨™æº– API æ›´å¿«
- æ¶ˆè€—è³‡æºæ›´å°‘
- å¤§å¤šæ•¸ç¶²ç«™éƒ½æ”¯æ´

---

### 2. æŒ‡å®š wait_for é¸æ“‡å™¨

```json
{
  "url": "https://example.com",
  "wait_for": ".article-content"  â† æ¨è–¦
}
```

**åŸå› ï¼š**
- æ›´æº–ç¢º
- æ¸›å°‘ç­‰å¾…æ™‚é–“
- é¿å…éæ—©æå–å…§å®¹

---

### 3. åœ¨ n8n ä¸­è™•ç†éŒ¯èª¤

**ä½¿ç”¨ IF ç¯€é»æª¢æŸ¥ successï¼š**

```
HTTP Request (parse-dynamic)
â†“
IF {{ $json.success === true }}
â”œâ”€ True â†’ ç¹¼çºŒè™•ç†
â””â”€ False â†’ è¨˜éŒ„éŒ¯èª¤æˆ–é‡è©¦
```

---

## ğŸ“ˆ å‡ç´šè·¯å¾‘

### v1.2.0 â†’ v1.3.0

**æ–°åŠŸèƒ½ï¼š**
- âœ… Playwright æ”¯æ´
- âœ… `/api/parse-dynamic` ç«¯é»
- âœ… JavaScript æ¸²æŸ“
- âœ… å‹•æ…‹å…§å®¹æå–

**å…¼å®¹æ€§ï¼š**
- âœ… æ‰€æœ‰èˆŠç«¯é»ä»ç„¶å¯ç”¨
- âœ… ç„¡éœ€ä¿®æ”¹ç¾æœ‰ n8n å·¥ä½œæµ
- âœ… å¯ä»¥é€æ­¥é·ç§»åˆ°æ–°ç«¯é»

---

## ğŸš€ ç«‹å³æ¸¬è©¦

```bash
# å¥åº·æª¢æŸ¥ï¼ˆç¢ºèªç‰ˆæœ¬ï¼‰
curl https://web-production-32568.up.railway.app/health

# æ‡‰è©²é¡¯ç¤ºï¼š
# {
#   "version": "1.3.0",
#   "features": ["playwright-dynamic-rendering", ...]
# }

# æ¸¬è©¦ Playwright ç«¯é»
curl -X POST https://web-production-32568.up.railway.app/api/parse-dynamic \
  -H "Content-Type: application/json" \
  -d '{"url": "https://applealmond.com/posts/296254"}' \
  | jq '.data.title'
```

---

## ğŸ’¡ å°æç¤º

1. **Playwright æ¯”æ¨™æº–æ–¹æ³•æ…¢ 2-3 å€**
   - åªåœ¨å¿…è¦æ™‚ä½¿ç”¨
   
2. **Railway å¯èƒ½éœ€è¦ 3-5 åˆ†é˜å®Œæˆéƒ¨ç½²**
   - å› ç‚ºéœ€è¦å®‰è£ Chromium ç€è¦½å™¨
   
3. **è³‡æºæ¶ˆè€—**
   - Playwright æœƒå¢åŠ å…§å­˜ä½¿ç”¨
   - Railway å…è²»æ–¹æ¡ˆå¯èƒ½å—é™

4. **æœ€ä½³åŒ–å»ºè­°**
   - å…ˆç”¨æ¨™æº– API æ¸¬è©¦
   - å¤±æ•—æ™‚æ‰åˆ‡æ›åˆ° Playwright
   - åœ¨ n8n ä¸­ä½¿ç”¨ IF ç¯€é»è‡ªå‹•åˆ‡æ›

---

## ğŸŠ ç¸½çµ

**Playwright åŠŸèƒ½è®“ä½ çš„ Parser API èƒ½å¤ è™•ç† 100% çš„ç¶²ç«™ï¼**

| ä¹‹å‰ | ç¾åœ¨ |
|------|------|
| âŒ å‹•æ…‹ç¶²ç«™ç„¡æ³•è§£æ | âœ… å®Œå…¨æ”¯æ´ |
| âŒ SPA ç¶²ç«™å¤±æ•— | âœ… å®Œå…¨æ”¯æ´ |
| âŒ JavaScript å…§å®¹éºå¤± | âœ… å®Œå…¨åŸ·è¡Œ |
| æˆåŠŸç‡ ~70% | æˆåŠŸç‡ ~95%+ |

**æº–å‚™å¥½äº†å—ï¼Ÿæ¨é€ä»£ç¢¼åˆ° Railwayï¼Œé–‹å§‹æ¸¬è©¦ï¼** ğŸš€

```bash
git push
```

